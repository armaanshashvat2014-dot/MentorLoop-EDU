<!DOCTYPE html>
<html>
<head>
<title>Grade Test | MentorLoop EDU</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#0f172a,#1e293b);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  color:white;
}
.card{
  background:#1e293b;
  padding:30px;
  border-radius:20px;
  width:95%;
  max-width:750px;
}
h2{text-align:center;color:#22d3ee;}
.question{
  margin:20px 0;
  padding:15px;
  background:#0f172a;
  border-radius:10px;
}
button{
  width:100%;
  padding:12px;
  margin-top:10px;
  background:#334155;
  border:none;
  border-radius:8px;
  color:white;
  cursor:pointer;
}
button:hover{
  background:#22d3ee;
  color:black;
}
.progress{
  height:6px;
  background:#334155;
  border-radius:4px;
  overflow:hidden;
  margin-bottom:15px;
}
.bar{
  height:100%;
  width:0%;
  background:#22d3ee;
  transition:0.3s;
}
</style>
</head>
<body>

<div class="card">
<h2 id="title"></h2>

<div class="progress">
<div class="bar" id="bar"></div>
</div>

<div class="question" id="questionText"></div>
<div id="options"></div>
</div>

<script>

// -------- GET LEVEL --------
const params = new URLSearchParams(window.location.search);
const level = params.get("level") || "primary";

// -------- SHUFFLE --------
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

// -------- QUESTION BANKS (4 TESTS) --------
const banks = {

primary: [
{q:"5 + 3 = ?",a:["8","7","6","9"],c:0},
{q:"2 x 4 = ?",a:["8","6","4","10"],c:0},
{q:"Color of sky?",a:["Blue","Green","Red","Black"],c:0},
{q:"10 - 4 = ?",a:["6","5","4","7"],c:0},
{q:"Which is fruit?",a:["Apple","Carrot","Potato","Onion"],c:0}
],

lowersecondary: [
{q:"Solve 5x=25",a:["5","10","25","0"],c:0},
{q:"H2O is?",a:["Water","Salt","Iron","Air"],c:0},
{q:"6 x 7 = ?",a:["42","36","48","40"],c:0},
{q:"Square root of 81?",a:["9","8","7","6"],c:0},
{q:"Density formula?",a:["mass/volume","volume/mass","mass*volume","none"],c:0}
],

uppersecondary: [
{q:"Derivative of x²?",a:["2x","x","x²","1"],c:0},
{q:"Newton's 2nd law?",a:["F=ma","E=mc²","V=IR","P=IV"],c:0},
{q:"Log10(100)?",a:["2","1","10","0"],c:0},
{q:"Integration of 2x?",a:["x² + C","2x²","x + C","None"],c:0},
{q:"Smallest unit of life?",a:["Cell","Atom","Molecule","Tissue"],c:0}
],

seniorsecondary: [
{q:"Integration of x?",a:["x²/2 + C","x²","1","x"],c:0},
{q:"Derivative of sinx?",a:["cosx","-cosx","sinx","-sinx"],c:0},
{q:"Limit of sinx/x at 0?",a:["1","0","∞","-1"],c:0},
{q:"Unit of resistance?",a:["Ohm","Volt","Watt","Ampere"],c:0},
{q:"Value of g approx?",a:["9.8","8","10","7"],c:0}
]

};

// -------- SELECT TEST --------
let selected = banks[level] || banks["primary"];
let quiz = shuffle([...selected]).slice(0,5);

document.getElementById("title").innerText =
level.charAt(0).toUpperCase() + level.slice(1) + " Test";

let index=0;
let score=0;

function loadQuestion(){

if(index >= quiz.length){

const percentage=((score/quiz.length)*100).toFixed(1);

// -------- SAVE GLOBAL STATS --------
let testsTaken = parseInt(localStorage.getItem("ml_tests_taken") || "0");
let totalScore = parseInt(localStorage.getItem("ml_total_score") || "0");
let totalQuestions = parseInt(localStorage.getItem("ml_total_questions") || "0");

testsTaken++;
totalScore += score;
totalQuestions += quiz.length;

localStorage.setItem("ml_tests_taken", testsTaken);
localStorage.setItem("ml_total_score", totalScore);
localStorage.setItem("ml_total_questions", totalQuestions);

// -------- SAVE SUBJECT STATS --------
let subjectStats = JSON.parse(localStorage.getItem("ml_subject_stats") || "{}");

if(!subjectStats[level]){
subjectStats[level] = { score:0, total:0 };
}

subjectStats[level].score += score;
subjectStats[level].total += quiz.length;

localStorage.setItem("ml_subject_stats", JSON.stringify(subjectStats));

document.querySelector(".card").innerHTML = `
<h2>Test Complete</h2>
<p><strong>Score:</strong> ${score}/${quiz.length}</p>
<p><strong>Percentage:</strong> ${percentage}%</p>
<button onclick="window.location.href='dashboard.html'">
Back to Dashboard
</button>
`;

return;
}

updateProgress();

const q = quiz[index];
document.getElementById("questionText").innerText = q.q;

const optDiv = document.getElementById("options");
optDiv.innerHTML="";

q.a.forEach((opt,i)=>{
const btn=document.createElement("button");
btn.innerText=opt;
btn.onclick=()=>{
if(i===q.c) score++;
index++;
loadQuestion();
};
optDiv.appendChild(btn);
});
}

function updateProgress(){
document.getElementById("bar").style.width =
(index/quiz.length*100)+"%";
}

loadQuestion();

</script>

</body>
</html>
